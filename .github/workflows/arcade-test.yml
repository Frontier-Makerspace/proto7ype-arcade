name: Arcade Game Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch: # Allow manual triggering

jobs:
  test:
    name: Test Arc Bundas
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
    
    - name: ğŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ“¦ Install dependencies
      run: npm ci
    
    - name: ğŸ® Run automated game test
      run: npm test
      env:
        HEADLESS: true
        SCREENSHOT: true
    
    - name: ğŸ“¸ Upload screenshots
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: test-screenshots
        path: |
          test-start.png
          test-end.png
        if-no-files-found: ignore
    
    - name: âœ… Test passed
      if: success()
      run: |
        echo "ğŸ‰ All tests passed!"
        echo "Both players achieved positive scores"
        echo "Game is ready for deployment"
    
    - name: âŒ Test failed
      if: failure()
      run: |
        echo "âš ï¸ Tests failed!"
        echo "Check the test output and screenshots for details"
        exit 1

  # Future: Add deployment job that runs after tests pass
  # deploy:
  #   name: Deploy to Arcade Cabinet
  #   needs: test
  #   runs-on: ubuntu-latest
  #   if: github.ref == 'refs/heads/main'
  #   
  #   steps:
  #   - name: ğŸ“¥ Checkout code
  #     uses: actions/checkout@v4
  #   
  #   - name: ğŸš€ Deploy to cabinet
  #     run: |
  #       # Add your deployment script here
  #       # Examples:
  #       # - rsync to cabinet via SSH
  #       # - Copy to network share
  #       # - Trigger cabinet to pull from git
  #       echo "Deploy step - customize based on your setup"
